!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("@clappr/core")):"function"==typeof define&&define.amd?define(["@clappr/core"],e):(t=t||self).ContextMenuPlugin=e(t.Clappr)}(this,(function(t){"use strict";function e(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function n(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}function o(t){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function i(t,e){return(i=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function s(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function c(t,e,n){return(c="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,n){var i=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=o(t)););return t}(t,e);if(i){var s=Object.getOwnPropertyDescriptor(i,e);return s.get?s.get.call(n):s.value}})(t,e,n||t)}var a=".context-menu {\n  z-index: 999;\n  position: absolute;\n  top: 0;\n  left: 0;\n  text-align: center; }\n  .context-menu .context-menu-list {\n    font-family: \"Proxima Nova\";\n    font-size: 12px;\n    line-height: 12px;\n    list-style-type: none;\n    text-align: left;\n    padding: 5px;\n    margin-left: auto;\n    margin-right: auto;\n    background-color: rgba(0, 0, 0, 0.75);\n    border: 1px solid #666;\n    border-radius: 4px; }\n    .context-menu .context-menu-list .context-menu-list-item {\n      color: white;\n      padding: 5px;\n      cursor: pointer; }\n      .context-menu .context-menu-list .context-menu-list-item:hover {\n        color: #2b669a; }\n      .context-menu .context-menu-list .context-menu-list-item[data-no-action] {\n        pointer-events: none; }\n      .context-menu .context-menu-list .context-menu-list-item[data-loop].on:after {\n        content: 'ON'; }\n      .context-menu .context-menu-list .context-menu-list-item[data-loop].off:after {\n        content: 'OFF'; }\n";!function(t,e){void 0===e&&(e={});var n=e.insertAt;if(t&&"undefined"!=typeof document){var o=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===n&&o.firstChild?o.insertBefore(i,o.firstChild):o.appendChild(i),i.styleSheet?i.styleSheet.cssText=t:i.appendChild(document.createTextNode(t))}}(a);return function(e){function r(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,r),(e=s(this,o(r).call(this,t))).init(),e}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&i(t,e)}(r,e),n(r,[{key:"name",get:function(){return"context_menu"}},{key:"supportedVersion",get:function(){return{min:t.version}}},{key:"attributes",get:function(){return{class:"context-menu"}}},{key:"template",get:function(){return t.template('<ul class="context-menu-list">\n  <% if(options) { %>\n    <% for (var i = 0; i < options.length; i++) { %>\n        <li class="context-menu-list-item <%=options[i].class%>" data-<%=options[i].name%> <% if(options[i].noAction) { %> data-no-action <% } %>\n        ><%=options[i].label%></li>\n    <% } %>\n  <% } %>\n</ul>\n')}},{key:"defaultMenuItems",get:function(){return[this.copyURL,this.copyURLCurrentTime,this.loop,this.playerVersion]}},{key:"loopEnable",get:function(){return this.core.activePlayback&&this.core.activePlayback.el&&this.core.activePlayback.el.loop}},{key:"playerVersion",get:function(){return{label:"Clappr Player v".concat(t.version),name:"playerVersion",noAction:!0}}},{key:"copyURL",get:function(){return{label:"Copy URL",name:"copyURL"}}},{key:"copyURLCurrentTime",get:function(){return{label:"Copy URL on current time",name:"copyURLCurrentTime"}}},{key:"loop",get:function(){return{label:"Loop: ",name:"loop",class:this.core.options.loop?"on":"off"}}},{key:"events",get:function(){var t=this,e={"click [data-copyURL]":"onCopyURL","click [data-copyURLCurrentTime]":"onCopyURLCurrentTime","click [data-loop]":"onToggleLoop"};return this.extraOptions&&this.extraOptions.forEach((function(n){if("function"==typeof n.callback){var o="".concat(n.name,"Callback");t[o]=n.callback,e["click [data-".concat(n.name,"]")]=o}})),e}}]),n(r,[{key:"init",value:function(){this.extraOptions=this.options.contextMenu&&this.options.contextMenu.extraOptions||[],this.delegateEvents(this.events),this.bindEvents()}},{key:"bindEvents",value:function(){var e=this,n=[{object:this.core,event:t.Events.CORE_ACTIVE_CONTAINER_CHANGED,callback:this.containerChanged},{object:this.core,event:t.Events.CORE_RESIZE,callback:this.registerPlayerResize}];n.forEach((function(t){return e.stopListening(t.object,t.event,t.callback)})),n.forEach((function(t){return e.listenTo(t.object,t.event,t.callback)})),this.bindCustomEvents()}},{key:"bindContainerEvents",value:function(){var e=this,n=[{object:this.container,event:t.Events.CONTAINER_CONTEXTMENU,callback:this.toggleContextMenu},{object:this.container,event:t.Events.CONTAINER_CLICK,callback:this.hide}];this.container&&n.forEach((function(t){return e.listenTo(t.object,t.event,t.callback)}))}},{key:"bindCustomEvents",value:function(){$("body").off("click",this.hide.bind(this)),$("body").on("click",this.hide.bind(this))}},{key:"destroy",value:function(){$("body").off("click",this.hide.bind(this)),this.isRendered=!1,c(o(r.prototype),"destroy",this).call(this)}},{key:"registerPlayerResize",value:function(t){t.width&&"number"==typeof t.width&&(this.playerSize=t)}},{key:"containerChanged",value:function(){this.container&&this.stopListening(this.container),this.container=this.core.activeContainer,this.bindContainerEvents()}},{key:"toggleContextMenu",value:function(t){t.preventDefault(),this.show(t.offsetY,t.offsetX)}},{key:"show",value:function(t,e){!this.playerElement&&this.calculateContextMenuLimit();var n=t>this.maxHeight?this.maxHeight:t,o=e>this.maxWidth?this.maxWidth:e;this.hide(),this.$el.css({top:n,left:o}),this.$el.show()}},{key:"calculateContextMenuLimit",value:function(){this.maxWidth=this.playerSize&&this.playerSize.width-160,this.maxHeight=this.playerSize&&this.playerSize.height-200}},{key:"hide",value:function(){this.$el.hide()}},{key:"copyToClipboard",value:function(t,e){if(e){var n=$('<textarea class="copytextarea"/>');n.text(t),e.append(n[0]),this.el.querySelector(".context-menu .copytextarea").select();try{document.execCommand("copy")}catch(t){throw Error(t)}n.remove()}}},{key:"onCopyURL",value:function(){this.copyToClipboard(window.location.href,this.$el)}},{key:"onCopyURLCurrentTime",value:function(){var t=window.location.href,e=Math.floor(this.container.getCurrentTime());if(""===window.location.search)t+="?t=".concat(e);else if(-1===window.location.search.split(/[\?=&]/g).indexOf("t"))t+="&t=".concat(e);else if(-1!==window.location.search.split(/[\?=&]/g).indexOf("t")){var n=window.location.search.split(/[\?&]/g).find((function(t){return t.includes("t=")})),o=window.location.search.replace(n,"t=".concat(e));t="".concat(t.replace(window.location.search,"")).concat(o)}this.copyToClipboard(t,this.$el)}},{key:"onToggleLoop",value:function(){this.core.options&&(this.core.options.loop=!this.loopEnable),this.core.activePlayback&&this.core.activePlayback.el&&(this.core.activePlayback.el.loop=!this.loopEnable),this.$el.find("[data-loop]").toggleClass("on",this.loopEnable),this.$el.find("[data-loop]").toggleClass("off",!this.loopEnable)}},{key:"appendExtraOptions",value:function(t){t.callback&&"function"==typeof t.callback||(t.noAction=!0),this.menuOptions.unshift(t)}},{key:"addCustomStyle",value:function(){var t=this.options.contextMenu&&this.options.contextMenu.customStyle;t&&(this.$el.css(t.container),this.$list.css(t.list),this.$listItem.css(t.items))}},{key:"sanitizeCustomizedItems",value:function(){var t=this,e=[];return this.options.contextMenu.menuItems.forEach((function(n){void 0!==t[n]&&e.push(t[n])})),e}},{key:"cacheElements",value:function(){this.$list=this.$el.find(".context-menu-list"),this.$listItem=this.$el.find(".context-menu-list-item")}},{key:"render",value:function(){var e=this;if(!this.isRendered){this.customMenuItems=this.options.contextMenu&&this.options.contextMenu.menuItems&&this.sanitizeCustomizedItems(),this.menuOptions=this.customMenuItems&&this.customMenuItems.length>0?this.customMenuItems:this.defaultMenuItems;var n=this.options.contextMenu&&this.options.contextMenu.extraOptions;return n&&n.forEach((function(t){return e.appendExtraOptions(t)})),this.$el.html(this.template({options:this.menuOptions})),this.$el.append(t.Styler.getStyleFor(a)),this.core.$el[0].append(this.$el[0]),this.cacheElements(),this.hide(),this.disable(),this.addCustomStyle(),this.isRendered=!0,this}}}]),r}(t.UICorePlugin)}));
